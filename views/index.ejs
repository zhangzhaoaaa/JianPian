<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Jumbotron Template for Bootstrap</title>
    <link rel='stylesheet' href='javascripts/bootstrap/dist/css/bootstrap.min.css' />
    <link rel='stylesheet' href='stylesheets/magnific-popup.css' />
    <link rel='stylesheet' href='stylesheets/main.css' />
    <link rel='stylesheet' href='stylesheets/sticky-footer.css' />
    <!-- <link rel='stylesheet' href='stylesheets/signin.css' />-->
    <script src='javascripts/jquery/dist/jquery.min.js' ></script>
    <script src='javascripts/bootstrap/dist/js/bootstrap.min.js' ></script>
    <script src='javascripts/imagesloaded.pkgd.min.js' ></script>
    <script src='javascripts/jquery.magnific-popup.min.js' ></script>
    <script src='javascripts/wookmark.js' ></script>
</head>

<body>
<% include header %>
<div class="container">
    <!-- Example row of columns -->
    <div class="row">
        <ul id="myTab" class="nav nav-tabs">
            <li class="active"><a href="#home" data-toggle="tab">
                    最新出发</a></li>
            <li><a href="#ios" data-toggle="tab">往日回顾</a></li>
        </ul>
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade in active" id="home">
                <div role="main">

                    <ul id="container" class="tiles-wrap animated">

                    </ul>

                </div>
            </div>
            <div class="tab-pane fade" id="ios">
                <div>

                    <ul id="containerOld" class="tiles-wrap animated">
                        <!-- These are our grid blocks -->
                        <li>
                            <a href="../images/sample-images/image_1_big.jpg">
                                <img src="../images/sample-images/image_1.jpg" width="200" height="283">
                            </a>
                            <p>1</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_2_big.jpg">
                                <img src="../images/sample-images/image_2.jpg" width="200" height="300">
                            </a>
                            <p>2</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_3_big.jpg">
                                <img src="../images/sample-images/image_3.jpg" width="200" height="252">
                            </a>
                            <p>3</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_4_big.jpg">
                                <img src="../images/sample-images/image_4.jpg" width="200" height="158">
                            </a>
                            <p>4</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_5_big.jpg">
                                <img src="../images/sample-images/image_5.jpg" width="200" height="300">
                            </a>
                            <p>5</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_6_big.jpg">
                                <img src="../images/sample-images/image_6.jpg" width="200" height="297">
                            </a>
                            <p>6</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_7_big.jpg">
                                <img src="../images/sample-images/image_7.jpg" width="200" height="200">
                            </a>
                            <p>7</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_8_big.jpg">
                                <img src="../images/sample-images/image_8.jpg" width="200" height="200">
                            </a>
                            <p>8</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_1_big.jpg">
                                <img src="../images/sample-images/image_1.jpg" width="200" height="283">
                            </a>
                            <p>1</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_2_big.jpg">
                                <img src="../images/sample-images/image_2.jpg" width="200" height="300">
                            </a>
                            <p>2</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_3_big.jpg">
                                <img src="../images/sample-images/image_3.jpg" width="200" height="252">
                            </a>
                            <p>3</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_4_big.jpg">
                                <img src="../images/sample-images/image_4.jpg" width="200" height="158">
                            </a>
                            <p>4</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_5_big.jpg">
                                <img src="../images/sample-images/image_5.jpg" width="200" height="300">
                            </a>
                            <p>5</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_6_big.jpg">
                                <img src="../images/sample-images/image_6.jpg" width="200" height="297">
                            </a>
                            <p>6</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_7_big.jpg">
                                <img src="../images/sample-images/image_7.jpg" width="200" height="200">
                            </a>
                            <p>7</p>
                        </li>
                        <li>
                            <a href="../images/sample-images/image_8_big.jpg">
                                <img src="../images/sample-images/image_8.jpg" width="200" height="200">
                            </a>
                            <p>8</p>
                        </li>

                        <!-- End of grid blocks -->
                    </ul>

                </div>
            </div>
        </div>
    </div>

    <hr>

</div> <!-- /container -->
<% include footer %>
<script type="text/javascript">
    (function ($) {
        // Prepare layout options.
        var wookmark;
        var wook;
        // Init lightbox
        $('#container').magnificPopup({
            delegate: 'li:not(.inactive) a',
            type: 'image',
            gallery: {
                enabled: true
            }
        });

        // Call the layout function after all images have loaded
        /* imagesLoaded('#container', function () {
            wookmark = new Wookmark('#container', {
                offset: 2, // Optional, the distance between grid items
                itemWidth: 210 // Optional, the width of a grid item
            });
        });*/
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            // 获取已激活的标签页的名称
            var activeTab = $(e.target).text();
            // 获取前一个激活的标签页的名称
           // var previousTab = $(e.relatedTarget).text();
           // $(".active-tab span").html(activeTab);
           // $(".previous-tab span").html(previousTab);
            $('#containerOld').magnificPopup({
                delegate: 'li:not(.inactive) a',
                type: 'image',
                gallery: {
                    enabled: true
                }
            });

            // Call the layout function after all images have loaded
            imagesLoaded('#containerOld', function () {
                wook = new Wookmark('#containerOld', {
                    offset: 2, // Optional, the distance between grid items
                    itemWidth: 210 // Optional, the width of a grid item
                });
            });
        });
        var wookmark = undefined,
                page = 1,
                isLoading = false,
                apiURL = '/getLastestPicture',
                lastRequestTimestamp = 0,
                fadeInDelay = 2000,
                container = '#container',
                $container = $(container),
                $loaderCircle = $('#loaderCircle'),
                $window = $(window),
                $document = $(document);

        /**
         * When scrolled all the way to the bottom, add more tiles.
         */
        function onScroll(event) {
            // Only check when we're not still waiting for data.
            if (!isLoading) {
                // Check if we're within 100 pixels of the bottom edge of the broser window.
                var closeToBottom = ($window.scrollTop() + $window.height() > $document.height() - 100);
                if (closeToBottom) {
                    // Only allow requests every second
                    var currentTime = new Date().getTime();
                    if (lastRequestTimestamp < currentTime - 1000) {
                        lastRequestTimestamp = currentTime;
                        loadData();
                    }
                }
            }
        };

        /**
         * Refreshes the layout.
         */
        function applyLayout($newImages) {
            $container.append($newImages);

            imagesLoaded(container, function () {
                // Destroy the old handler
                if (wookmark === undefined) {
                    wookmark = new Wookmark(container, {
                        offset: 2, // Optional, the distance between grid items
                        itemWidth: 210 // Optional, the width of a grid item
                    });
                } else {
                    wookmark.initItems();
                    wookmark.layout(true);
                }

                // Set opacity for each new image at a random time
                $newImages.each(function () {
                    var $self = $(this);
                    window.setTimeout(function () {
                        $self.css('opacity', 1);
                    }, Math.random() * fadeInDelay);
                });
            });
        };

        /**
         * Loads data from the API.
         */
        function loadData() {
            isLoading = true;
            $loaderCircle.show();

            $.ajax({
                url: apiURL,
                dataType: 'json', // Set to jsonp if you use a server on a different domain and change it's setting accordingly
                data: {page: page}, // Page parameter to make sure we load new data
                success: onLoadData
            });
        };

        /**
         * Receives data from the API, creates HTML for images and updates the layout
         */
        function onLoadData(response) {
            isLoading = false;
            $loaderCircle.hide();

            // Increment page index for future calls.
            page++;

            // Create HTML for the images.
            var html = '',
                    data = response.data,
                    i = 0, length = data.length, image, opacity,
                    $newImages;

            for (; i < length; i++) {
                image = data[i];

                html += '<li>';
                html += '<a target="_blank" href="'+image.image+'" title="'+image.title+'">';
                // Image tag (preview in Wookmark are 200px wide, so we calculate the height based on that).
                html += '<img src="'+image.preview+'" width="200" height="'+Math.round(image.height/image.width*200)+'">';
                html += '</a>';
                // Image title.
                html += '<p>'+image.title+'</p>';
                html += '</li>';
            }

            $newImages = $(html);

            // Disable requests if we reached the end
            if (response.message == 'No more pictures') {
                $document.off('scroll', onScroll);
            }

            // Apply layout.
            applyLayout($newImages);
        };

        // Capture scroll event.
        $document.on('scroll', onScroll);

        // Load first data from the API.
        loadData();
    })(jQuery);
</script>
</body>
</html>
